<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skills Distribution Test - Werewolf 5e</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        h1 {
            color: #00ff00;
            text-align: center;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            background: #0a0a0a;
        }
        .pass {
            color: #00ff00;
        }
        .fail {
            color: #ff0000;
        }
        pre {
            background: #000;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Skills Distribution Test Suite</h1>
    <div id="output"></div>
    
    <script>
        // Copy skill definitions
        const allSkills = {
            academics: { name: 'Academics', base: 1, category: 'mental' },
            craft: { name: 'Craft', base: 1, category: 'mental' },
            performance: { name: 'Performance', base: 1, category: 'social' },
            science: { name: 'Science', base: 1, category: 'mental' },
            athletics: { name: 'Athletics', base: 0, category: 'physical' },
            awareness: { name: 'Awareness', base: 0, category: 'mental' },
            brawl: { name: 'Brawl', base: 0, category: 'physical' },
            empathy: { name: 'Empathy', base: 0, category: 'social' },
            etiquette: { name: 'Etiquette', base: 0, category: 'social' },
            firearms: { name: 'Firearms', base: 0, category: 'physical' },
            insight: { name: 'Insight', base: 0, category: 'mental' },
            intimidation: { name: 'Intimidation', base: 0, category: 'social' },
            investigation: { name: 'Investigation', base: 0, category: 'mental' },
            leadership: { name: 'Leadership', base: 0, category: 'social' },
            larceny: { name: 'Larceny', base: 0, category: 'physical' },
            medicine: { name: 'Medicine', base: 0, category: 'mental' },
            melee: { name: 'Melee', base: 0, category: 'physical' },
            occult: { name: 'Occult', base: 0, category: 'mental' },
            persuasion: { name: 'Persuasion', base: 0, category: 'social' },
            stealth: { name: 'Stealth', base: 0, category: 'physical' },
            streetwise: { name: 'Streetwise', base: 0, category: 'social' },
            subterfuge: { name: 'Subterfuge', base: 0, category: 'social' },
            survival: { name: 'Survival', base: 0, category: 'physical' },
            technology: { name: 'Technology', base: 0, category: 'mental' }
        };
        
        const skillDistributions = {
            jack: {
                name: 'Jack of All Trades',
                totalPoints: 29,
                distribution: { 3: 1, 2: 8, 1: 10 }
            },
            balanced: {
                name: 'Balanced',
                totalPoints: 26,
                distribution: { 3: 3, 2: 5, 1: 7 }
            },
            specialist: {
                name: 'Specialist',
                totalPoints: 22,
                distribution: { 4: 1, 3: 3, 2: 3, 1: 3 }
            }
        };
        
        // Initialize skills
        function initializeSkills() {
            const skillPoints = {};
            Object.keys(allSkills).forEach(skill => {
                skillPoints[skill] = allSkills[skill].base;
            });
            return skillPoints;
        }
        
        // Get current distribution
        function getCurrentDistribution(skillPoints) {
            const dist = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
            Object.values(skillPoints).forEach(val => {
                dist[val]++;
            });
            return dist;
        }
        
        // Check if skill can accept more points
        function canAddPointToSkill(skill, skillPoints, requiredDistribution) {
            const currentValue = skillPoints[skill];
            
            if (currentValue >= 5) return false;
            
            const targetValue = currentValue + 1;
            const currentDist = getCurrentDistribution(skillPoints);
            
            if (requiredDistribution[targetValue] && currentDist[targetValue] < requiredDistribution[targetValue]) {
                return true;
            }
            
            return false;
        }
        
        // Check if distribution is complete
        function isDistributionComplete(skillPoints, requiredDistribution) {
            const currentDist = getCurrentDistribution(skillPoints);
            
            for (let level in requiredDistribution) {
                if (currentDist[level] < requiredDistribution[level]) {
                    return false;
                }
            }
            
            return true;
        }
        
        // Test a specific distribution type
        function testDistributionType(typeName, typeConfig) {
            const output = [];
            output.push(`<h2>Testing: ${typeConfig.name}</h2>`);
            output.push(`<p>Required: ${JSON.stringify(typeConfig.distribution)}</p>`);
            
            let skillPoints = initializeSkills();
            let iterations = 0;
            const maxIterations = 1000;
            
            // Simulate adding points
            while (!isDistributionComplete(skillPoints, typeConfig.distribution) && iterations < maxIterations) {
                iterations++;
                
                // Get available skills
                const availableSkills = Object.keys(skillPoints).filter(skill => 
                    canAddPointToSkill(skill, skillPoints, typeConfig.distribution)
                );
                
                if (availableSkills.length === 0) {
                    output.push(`<p class="fail">ERROR: No available skills but distribution incomplete!</p>`);
                    break;
                }
                
                // Add point to random available skill
                const randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                skillPoints[randomSkill]++;
            }
            
            const finalDist = getCurrentDistribution(skillPoints);
            const isComplete = isDistributionComplete(skillPoints, typeConfig.distribution);
            
            output.push(`<p>Iterations: ${iterations}</p>`);
            output.push(`<p>Final distribution: ${JSON.stringify(finalDist)}</p>`);
            output.push(`<p class="${isComplete ? 'pass' : 'fail'}">Complete: ${isComplete ? 'YES ✓' : 'NO ✗'}</p>`);
            
            // Verify each requirement
            let allMatch = true;
            for (let level in typeConfig.distribution) {
                const required = typeConfig.distribution[level];
                const actual = finalDist[level];
                const matches = actual === required;
                if (!matches) allMatch = false;
                output.push(`<p class="${matches ? 'pass' : 'fail'}">  Level ${level}: ${actual}/${required} ${matches ? '✓' : '✗'}</p>`);
            }
            
            // Show skill breakdown
            output.push('<details>');
            output.push('<summary>Skill Breakdown</summary>');
            output.push('<pre>');
            const sortedSkills = Object.entries(skillPoints).sort((a, b) => b[1] - a[1]);
            sortedSkills.forEach(([skill, value]) => {
                output.push(`${allSkills[skill].name.padEnd(15)}: ${value}`);
            });
            output.push('</pre>');
            output.push('</details>');
            
            return { success: allMatch, html: output.join('') };
        }
        
        // Run all tests
        const resultsHtml = [];
        const testResults = [];
        
        for (let type in skillDistributions) {
            const result = testDistributionType(type, skillDistributions[type]);
            testResults.push(result.success);
            resultsHtml.push(`<div class="test-section">${result.html}</div>`);
        }
        
        // Display summary
        const allPassed = testResults.every(r => r);
        resultsHtml.unshift(`
            <div class="test-section">
                <h2 class="${allPassed ? 'pass' : 'fail'}">
                    ${allPassed ? '✓ ALL TESTS PASSED' : '✗ SOME TESTS FAILED'}
                </h2>
                <p>Jack of All Trades: ${testResults[0] ? 'PASS ✓' : 'FAIL ✗'}</p>
                <p>Balanced: ${testResults[1] ? 'PASS ✓' : 'FAIL ✗'}</p>
                <p>Specialist: ${testResults[2] ? 'PASS ✓' : 'FAIL ✗'}</p>
            </div>
        `);
        
        document.getElementById('output').innerHTML = resultsHtml.join('');
    </script>
</body>
</html>
